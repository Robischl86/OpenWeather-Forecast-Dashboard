<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>


    <script src="moment.js"></script>
    <script>
        moment().format();
        ////console.log(moment());
        ////console.log(moment().format("MMM Do YYYY")); 
    </script>

    <title>Levi's Weather Dashboard</title>
</head>

<body>
    <nav class="navbar navbar-light bg-light justify-content-center">
        <span>
            <h1>Levi's Weather Dashboard</h1>
        </span>
    </nav>
    <div class="container">
        <div class="jumbotron" style="border-style: solid; background-color: white;">

            <!--SECTION FOR CURRENT WEATHER-->
            <section id="currentWeatherHolder">
                <h3 id="currentDate"></h3>
                <h2 class="display-4" id="cityName"></h2>
                <img id="currentWeatherImg">
                <p class="lead thick" id="temperature"></p>
                <p class="lead thick" id="humidity"></p>
                <p class="lead thick" id="windspeed"></p>
                <div class="lead thick" id="uvIndex" style="display: inline; font-weight: 350;"></div>
                <div id="uvAmount"
                    style="display: inline; border-radius: 5px; padding: 3px 4px 3px 4px; font-weight: 350;">
                </div>
            </section>

            <!--SECTION FOR FORECAST-->
            <section id="forecastHolder"></section>

            <!--SEARCH FIELD-->
            <hr class="my-4">
            <p>Enter city name below to find its current weather and five-day forecast.</p>
            <input class="form-control" id="cityInput" type="text" placeholder="City Name">
            <br>
            <a class="btn btn-primary btn-lg" id="getWeatherBtn" href="#" role="button" style="margin-bottom: 10px;">Find City</a>

            <br>
            <!--BUTTONS THAT ARE MADE FROM PRIOR SEARCHES GO HERE-->
            <section id="cityHolder"></section>
        </div>

        <br>
    </div>
    <footer class="footer">
        <h3>Created by Levi Robischon (2020)</h3>
        <p>Made possible by OpenWeather API</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        //CITY ARRAY THAT WILL HOLD THE NAMES OF ALL CITIES THAT ARE SEARCHED
        let cityArray = ["0"];

        //DISPLAYING CURRENT DATE
        $("#currentDate").text(moment().format("MMM Do YYYY"));

        $(document).ready(function () {
            //GET WEATHER FROM TEXT FIELD AND "Find City" BUTTON
            $("#getWeatherBtn").on("click", function () {
                getWeather();
            });

            //GET WEATHER FROM TEXT FIELD AND ENTER KEY
            let enterInput = document.getElementById("cityInput");
            $("#cityInput").keypress(function(e) {
                let key = e.which;
                if (key == 13) {
                    getWeather();
                }
            });

            //GET WEATHER FUNCTION
            function getWeather() {
                let cityInput = $("#cityInput").val();
                let queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + cityInput + "&appid=3e36a353a513c2197f90f8494af1060a";
                forecastURL = "https://api.openweathermap.org/data/2.5/forecast?q=" + cityInput + "&appid=3e36a353a513c2197f90f8494af1060a"

                //AJAX    
                $.ajax({
                    url: queryURL,
                    method: "GET"
                }).then(function (response) {

                    //CITY NAME
                    $("#cityName").text(response.name)

                    //CURRENT WEATHER ICON
                    let weatherIcon = response.weather[0].icon;
                    $("#currentWeatherImg").attr("src", "https://openweathermap.org/img/wn/" + weatherIcon + "@2x.png");
                    $("#currentWeatherImg").css({ "background-color": "deepskyblue", "border-style": "solid", "border-color": "black", "border-radius": "10px", "margin": "10px 10px 20px 0px" })

                    //CURRENT TEMPERATURE
                    let temp = response.main.temp;
                    let F = Math.round((temp - 273.15) * 1.80 + 32);
                    $("#temperature").text("Temperature: " + F + "℉");

                    //CURRENT HUMIDITY
                    let humidity = response.main.humidity;
                    $("#humidity").text("Humidity: " + humidity + "%");

                    //CURRENT WIND SPEED
                    let wind = response.wind.speed;
                    $("#windspeed").text("Wind Speed: " + wind + " MPH");

                    //UV INDEX
                    let lon = response.coord.lon;
                    let lat = response.coord.lat;
                    let uvIndexURL = "https://api.openweathermap.org/data/2.5/uvi?appid=3e36a353a513c2197f90f8494af1060a&lat=" + lat + "&lon=" + lon;
                    $("#uvIndex").text("UV Index: ");

                    //CURRENT UV AMOUNT
                    $.ajax({
                        url: uvIndexURL,
                        method: "GET"
                    }).then(function (response) {

                        let uvAmount = response.value;
                        $("#uvAmount").text(uvAmount)

                        // Cities with a UV Amount above 6 will have a red background and white font-color
                        if (uvAmount > 6) {
                            $("#uvAmount").css({ "background-color": "red", "font-weight": "bold", "color": "white", "font-size": "large" })
                        }
                        else {
                            $("#uvAmount").css({ "background-color": "", "font-weight": "bold", "color": "black" })
                        }
                    });

                    //FORECAST API
                    $.ajax({
                        url: forecastURL,
                        method: "GET"
                    }).then(function (response) {

                        $("#forecastHolder").empty();
                        for (let i = 0; i < 40; i++) {

                            //Creating Div to store the forecast information
                            let forecastDiv = $("<div class='forecastDiv'>");

                            //If-statement so that the function only shows the forecast conditions for 3pm each day.
                            if (moment(response.list[i].dt_txt).format('LTS') == "3:00:00 PM") {

                                // FORECAST DATE
                                let forecastDate = moment(response.list[i].dt_txt).format('l');
                                let forecastHour = moment(response.list[i].dt_txt).format('LTS');
                                let ForecastHeader = $("<h4>").text(forecastDate);
                                forecastDiv.append(ForecastHeader);

                                // FORECAST ICON
                                let forecastImageID = response.list[i].weather[0].icon;
                                let forecastIconURL = "https://openweathermap.org/img/wn/" + forecastImageID + "@2x.png";
                                let forecastImageIcon = $("<img>").attr("src", forecastIconURL);
                                forecastDiv.append(forecastImageIcon);

                                // FORECAST TEMP
                                let forecastKelvin = response.list[i].main.temp;
                                let FF = Math.round((forecastKelvin - 273.15) * 1.80 + 32);
                                let forecastTemp = $("<h5>").text("Temp: " + FF + "℉")
                                forecastDiv.append(forecastTemp);

                                // FORECAST HUMIDITY
                                let FH = response.list[i].main.humidity;
                                let forecastHumidity = $("<h5>").text("Humidity: " + FH + "%")
                                forecastDiv.append(forecastHumidity);
                                $("#forecastHolder").append(forecastDiv);
                            };
                        };
                    });

                    $("#cityInput").val('');

                    //ADDING NEW BUTTON TO #cityHolder WHILE PREVENTING DUPLICATES
                    for (i = 0; i < cityArray.length; i++) {
                        if (cityArray.includes(response.name) === false) {
                            cityArray.push(response.name)
                            let cityButton = $("<button type='button' class='btn btn-info btn-lg' style ='margin: 10px 10px 0px 0px'>").text(response.name);
                            $("#cityHolder").append(cityButton);

                            //GET WEATHER FROM CITY BUTTON
                            $(cityButton).on("click", function () {
                                cityButtonName = $(cityButton).text();
                                $("#cityInput").val(cityButtonName);
                                getWeather();
                            });
                        };
                    };
                });
            };
        });

    </script>
</body>

</html>